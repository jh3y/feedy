!function(){angular.module("feedy.Services",[]),angular.module("feedy.Services").factory("Feed",["$rootScope","$http","$q","_",function(e,t,a,i){var r;return{process:function(e){var t,a;if(a=[],t=function(e){var t;return t=!1,r&&r.length>0&&i.forEach(r,function(a,i){a.link===e.link&&(t=!0)}),t},!(e&&e.items&&e.items.length))throw new Error("No data to be processed");return i.forEach(e.items,function(e,r){var d;return t(e)?void 0:(e.id=i.uniqueId(),void 0!==e.published&&(e.published=moment(e.published).format("[Published: ]Do MMM YYYY [at] h:mm")),e.author&&""!==e.author.trim&&(d=e.author.indexOf("(")+1,e.author=e.author.substr(d,e.author.length-(d+1))),e.tags&&""!==e.tags.trim&&(e.tags=e.tags.split(" ")),a.push(e))}),a.length>0&&(r?r.length&&(r=i.union(r,a)):r=a),{noobs:a,data:r}},get:function(e){return e?i.find(r,function(t){return t.id===e}):r},reset:function(){return r=void 0},update:function(e){var t=this,i=a.defer();return e&&e.reset&&t.reset(),t.fetch(e).then(function(e){try{i.resolve(t.process(e))}catch(a){i.reject(a)}}),i.promise},fetch:function(e){var i=a.defer(),r=e&&e.tags&&""!==e.tags.trim()?"tags="+e.tags.trim()+"&":"",d=e&&e.tagmode&&""!==e.tagmode.trim()?"tagmode="+e.tagmode.trim()+"&":"",n="https://api.flickr.com/services/feeds/photos_public.gne?"+r+d+"format=json&jsoncallback=JSON_CALLBACK";return t.jsonp(n).then(function(e){i.resolve(e.data)},function(e){i.reject(e.data)}),i.promise}}}]),angular.module("feedy.Directives",[]),angular.module("feedy.Directives").directive("feed",["$rootScope","$templateCache","_",function(e,t,a){return{templateUrl:"directives/Feed.html",restrict:"AE",transclude:!0,replace:!0,scope:{feedOpts:"=",feedData:"="},controller:["$scope","$element","$attrs",function(e,a,i){e.feedItemTmpl=t.get("directives/FeedItem.html")}],link:function(t,i,r,d){var n=i[0],l=600,o=a.debounce(function(){e.pos=n.scrollTop,n.scrollHeight-n.scrollTop<l&&t.$emit(t.feedOpts.requestEvent)},250);t.renderFeed=function(e,r){var d="";return r&&(i.empty(),n.scrollTop=0),a.forEach(e,function(e,i){d+=a.template(t.feedItemTmpl)(e)}),i.append(d)},i.on("scroll",o),t.feedData&&t.feedData.length>0&&(t.renderFeed(t.feedData),e.pos>0&&(n.scrollTop=e.pos)),t.feedOpts&&t.feedOpts.updateEvent&&t.$on(t.feedOpts.updateEvent,function(e,a){a.items.length>0&&t.renderFeed(a.items,a.reset)})}}}]),angular.module("feedy.Controllers",["feedy.Services"]),angular.module("feedy.Controllers").controller("FeedCtrl",["_","$rootScope","$scope","$timeout","$location","$routeParams","Feed",function(e,t,a,i,r,d,n){var l=e.debounce(function(e,t){return e||""===e?a.search():void 0},1e3);return a.feedData=void 0,a.tagMode="all",a.feedOpts={updateEvent:"newFeedData",requestEvent:"requestNewData"},a.switchTagMode=function(){return a.tagMode="all"===a.tagMode?"any":"all",a.tag&&""!==a.tag&&a.tag.split(",").length>1?a.search():void 0},a.search=function(){var e;return a.loading=!0,e={reset:!0,tags:a.tag,tagmode:a.tagMode},a.updateFeed(e)},a.updateFeed=function(e){var i;return i=e&&e.reset?!0:!1,e||""===a.tag||(e={tags:a.tag,tagmode:"all"}),n.update(e).then(function(e){return a.feedData=e.data,a.loading=!1,a.updating=!1,t.$broadcast(a.feedOpts.updateEvent,{items:e.noobs,reset:i})})},a.getFeed=function(){n.get()?a.feedData=n.get():(a.loading=!0,a.updateFeed())},a.getFeed(),a.$on(a.feedOpts.requestEvent,function(){return a.updating=!0,a.updateFeed()}),a.$watch("tag",l)}]),angular.module("feedy.Controllers").controller("ViewCtrl",["$scope","$sce","$location","$routeParams","Feed",function(e,t,a,i,r){return e.itemID=i.itemID,e.item=r.get(e.itemID),e.item?void("string"==typeof e.item.description&&(e.item.description=t.trustAsHtml(e.item.description))):a.path("/")}]);var e=angular.module("lodash",[]);e.factory("_",function(){return window._});angular.module("feedy",["lodash","ngRoute","feedy.Controllers","feedy.Directives","feedy.Services"]);angular.module("feedy").config(["$routeProvider",function(e){return e.when("/",{templateUrl:"views/feed.html"}).when("/view/:itemID",{templateUrl:"views/view.html"}).otherwise({redirectTo:"/"})}]),angular.module("feedy").run(["$templateCache",function(e){e.put("directives/Feed.html",'<ul class="feed bd--grey rd--border"></ul>'),e.put("directives/FeedItem.html",'<li class="feed-item"><div style="background-image: url(<%= media.m %>)" class="feed-item--image"><a href="#/view/<%=id%>" title="View details for <%= title %>."></a></div><div class="feed-item--details"><h1 class="feed-item--title tx--blue hv--pink"><a href="#/view/<%=id%>"><%= title %></a></h1><ul><li class="feed-item--detail"><a href="https://flickr.com/<%= author_id %>" target="_blank" title="See <%= author %> on flickr."><%= author %></a></li><li class="feed-item--detail published"><%= published %></li><li class="feed-item--detail"><a href="<%= link %>" target="_blank">View on flickr</a></li></ul></div></li>'),e.put("views/feed.html",'<div ng-controller="FeedCtrl"><div class="feed-controls"><input ng-model="tag" type="text" placeholder="Enter tags to narrow search (comma separated)" title="Input search tags." class="tx--black"/><div ng-click="switchTagMode()" ng-class="{\'is--any\': tagMode == \'any\'}" title="Select tag mode." class="tag-mode-switch bd--grey"><div class="tag-mode-switch--indicator"></div></div></div><div ng-class="{\'is--loading\': loading, \'is--updating\': updating}" class="feed-wrapper"><div data-feed="data-feed" data-feed-opts="feedOpts" data-feed-data="feedData"></div></div></div>'),e.put("views/view.html",'<div ng-controller="ViewCtrl" class="detail bd--grey rd--border padd"><a href="#/" class="btn bd--green bg--green tx--white item-view--back-btn">Back</a><div class="detail--title"><h1><a href="{{item.link}}" target="_blank">{{item.title}}</a></h1><p class="detail--"><a target="_blank" href="https://flickr.com/{{item.author_id}}"> {{item.author}}</a> | {{item.published}}</p></div><div><div class="detail--image-holder"><div><img src="{{item.media.m}}"/></div></div><div class="detail--description"><div ng-bind-html="item.description"></div><ul ng-if="item.tags.length &gt; 0" class="detail--tags"><li><a ng-repeat="tag in item.tags" href="https://www.flickr.com/search/?tags={{tag}}" target="_blank" class="feed-item--tag">{{tag}}</a></li></ul></div></div></div>')}])}();